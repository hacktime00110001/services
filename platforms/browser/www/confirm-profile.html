<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<meta property="og:title" content="TaxiTime"> 
		<meta name="description" content="">
		<meta property="og:description" content=""> 
		<meta name="twitter:title" content="TaxiTime">
		<meta name="twitter:description" content="">

		<meta property="og:image" content="./imgs/favicon.jpg">
		<meta property="og:type" content="website">
		<meta property="og:url" content="">
		<meta property="og:site_name" content="SixTouchesTTaxiTimeeam">

		<link rel="shortcut icon" type="shortcut icon" href="./imgs/favicon.jpg">

		<link rel="stylesheet" href="./libs/bootstrap.min.css"> 

		<link rel="stylesheet" href="./css/fonts.css">
		<link rel="stylesheet" href="./css/main.css">

		<title>TaxiTime</title>
		
	</head>
<body>
		<header>
			<div class="container">
				<div class="row flex-column align-items-center">
					<div class="analyticsTitle">
						<img src="./imgs/registrationLogo.png" alt="TxT">
						<p>Профиль водителя</p>
					</div>
				</div>
			</div>
		</header>
		<main>
			<div class="container">
				<div class="row flex-column align-items-center">
				<div class="addProfile_Card">
					<div class="addProfile_CardBlack">
						<div class="addProfile_CardLight">
						</div>
					</div>
					<p>Карта НЕФТЬ — клубная бонусная карта для водителей.<br>Заполни профиль и получи доступ к скидкам</p>
				</div>
				<form class="addProfile_Form" action="" method="post">
					<div class="posRel">
						<select onclick="selectOnClick(this)" onfocusout="selectOnFocusOut(this)" id="selectCat" class="w-100 op-0-0 selectEvent">
							<option selected>Город</option>
						</select>
						<div class="dropdowmMy" style="margin-top: 15px;">
							<p class="colorB4B0B0" id="getCity">Город</p>
							<img src="./imgs/arrow_down.png" alt="">
						</div>
					</div>
					<input class="addProfile_Input" type="text" id="name" placeholder="Имя">
					<input class="addProfile_Input" type="text" id="surname" placeholder="Фамилия">
					<input class="addProfile_Input" type="text" id="patronymic" placeholder="Отчество">
					<div class="addProfile_Hr"></div>
					<p class="fs_15">Дата рождения:</p>
					<div class="addProfile_Input_Date">
						<input class="addProfile_Input_Date1" type="text" id="day" placeholder="30" maxlength="2">
						<div class="posRel addProfile_Input_Date2">
							<select onclick="selectOnClick(this)" onfocusout="selectOnFocusOut(this)" class="w-100 op-0-0 selectEvent m-t-5 selectEvent_Date">
								<option selected>Январь</option>
								<option>Февраль</option>
								<option>Март</option>
								<option>Апрель</option>
								<option>Май</option>
								<option>Июнь</option>
								<option>Июль</option>
								<option>Август</option>
								<option>Сентябрь</option>
								<option>Октябрь</option>
								<option>Ноябрь</option>
								<option>Декабрь</option>
							</select>
							<div class="dropdowmMy m-t-5">
								<p class="selectEvent_DateP colorB4B0B0" id="month">Январь</p>
								<img src="./imgs/arrow_down.png" alt="">
							</div>
						</div>
						<input class="addProfile_Input_Date3" id="year" type="text" placeholder="1940" maxlength="4">
					</div>
					<div class="d-flex align-items-center">
						<p class="fs_15 mr-3">Стаж вождения:</p>
						<input class="addProfile_Input_Small" type="text" id="exp" placeholder="1" maxlength="2">
						<p class="fs_15 ml-2 expWord">год</p>
					</div>
				</form>
				<div class="driverProfile_SupportService">
				   <img src="./imgs/add_Alert.png" alt="!">
					<p>После сохранения данных, Вы не сможете их изменить. При вводе некорректных данных Вы не сможете получать скидки от партнёров.</p>
				</div>
				<input type="button" id="sendData" class="driverProfile_OrangeBtn" value="Отправить">
			</div>
		</div>
	</main>  

	
	
	<script type="text/javascript" src="./libs/jquery.min.js"></script>
	<script type="text/javascript" src="./libs/bootstrap.min.js"></script>
	
	<script src="./js/modal.js"></script>
	<script src="./js/checkPage.js"></script>
	<script src="./js/newSelectP.js"></script>
	<script src="./js/inputLimit.js"></script>

	<script type="text/javascript">
		$("#name").val(JSON.parse($store.getItem("userdata")).name); 

		$cityList = $("#selectCat");

		$.post("http://taxitime.pro/api/Profile.php", { 
			getCities: true
		}).done(function (data) {
			var cities = data.split(",");
			for(var i = 0; i < cities.length; i++) {
				$cityList.append(`<option>${cities[i]}</option>`);
			}
		}).fail(function(xhr, textStatus, error){
			modal_alert("Server error!", 2, "xhr.statusText: " + xhr.statusText + "<br>textStatus: " + textStatus + "<br>error: " + error + "<br>", function () {});
		});

		$("#sendData").click(function () {
			$("#sendData").prop('disabled', true);

			$city = $("#getCity").text();
			$name = $("#name").val();
			$surname = $("#surname").val();
			$patronymic = $("#patronymic").val();

			$day = +$("#day").val();
			$month = $("#month").text();
			$year = +$("#year").val();

			$driveExp = +$("#exp").val();

			if($city == "Город") {
				modal_alert("Ошибка ввода данных!", 1, "Вы не выбрали город!", function () {
					$('#sendData').prop('disabled', false);
				}); 
			} else if($name.length < 2 || $name.length > 20 || $name.match("^([А-Я])+([а-я]+)") == null) {
				modal_alert("Ошибка ввода данных!", 1, "Имя введено не коректно!", function () {
					$('#sendData').prop('disabled', false);
				});
			} else if($surname.length < 2 || $surname.length > 20 || $surname.match("^([А-Я])+([а-я]+)") == null) {
				modal_alert("Ошибка ввода данных!", 1, "Фамилия введена неверно!", function () {
					$('#sendData').prop('disabled', false);
				});
			} else if($day < 1 || $day > 31) {
				modal_alert("Ошибка ввода данных!", 1, "День рождения введён не коректно!", function () {
					$('#sendData').prop('disabled', false);
				});    
			} else if($year < 1900 || $year > 2002) {
				modal_alert("Ошибка ввода данных!", 1, "Год рождения введён не коректно!", function () {
					$('#sendData').prop('disabled', false);
				});    
			} else if($driveExp < 1 || $driveExp > 70) {
				modal_alert("Ошибка ввода данных!", 1, "Стаж вождения введён не коректно!", function () {
					$('#sendData').prop('disabled', false);
				});    
			} else {
				$date = $day + " " + $month + " " + $year;
				$driveExp = $driveExp + " " + $(".expWord").text();

				$.post("http://taxitime.pro/api/Profile.php", { 
					city: $city,
					name: $name,
					surname: $surname,
					patronymic: $patronymic,
					date: $date,
					driveExp: $driveExp,
					phonenumber: JSON.parse($store.getItem("userdata")).phonenumber
				}).done(function (data) {
					var userdata = JSON.parse(data);
					$store.clear();
					$store.setItem("userdata", JSON.stringify(userdata));
					modal_alert("Данные успешно обработаны!", 3, "Вы заполнили профиль!", function () {
						$('#sendData').prop('disabled', false);
						$store.setItem("currentPage", "profile.html");
						location.href = "./profile.html";
					}); 
				}).fail(function(xhr, textStatus, error){
					modal_alert("Server error!", 2, "xhr.statusText: " + xhr.statusText + "<br>textStatus: " + textStatus + "<br>error: " + error + "<br>", function () {
						$('#sendData').prop('disabled', false);
					});
				});
			}

		});

	</script>
	
</body>
</html>