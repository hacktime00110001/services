<!DOCTYPE html>
<html lang="ru">
	<head>
		<title>Taxi Time</title>

		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta property="og:title" content="TaxiTime"> 
		<meta name="description" content="">
		<meta property="og:description" content=""> 
		<meta name="twitter:title" content="TaxiTime">
		<meta name="twitter:description" content="">

		<meta property="og:image" content="./imgs/favicon.jpg">
		<meta property="og:type" content="website">
		<meta property="og:url" content="">
		<meta property="og:site_name" content="SixTouchesTTaxiTimeeam">

		<link rel="shortcut icon" type="shortcut icon" href="./imgs/favicon.jpg">

		<link rel="stylesheet" href="./libs/bootstrap.min.css"> 

		<link rel="stylesheet" href="./css/fonts.css">
		<link rel="stylesheet" href="./css/main.css">

	</head>
	<body>
	   
	<header>
		<div class="container">
			<div class="row flex-column align-items-center">
				<div class="analyticsTitle">
					<img src="./imgs/registrationLogo.png" alt="TxT">
					<p>Служба поддержки</p>
					<img class="back_support" src="./imgs/arrow_back.png" alt="TxT">
				</div>
			</div>
		</div>
	</header>
	<main>
		<div class="container">
			<div class="row flex-column align-items-center">
				<input type="email" id="email" class="support_inp" placeholder="Ваша почта" maxlength="30">
				<div class="posRel" style="width:85%;margin: 29px 0 29px 0;">
					<select onclick="selectOnClick(this)" onfocusout="selectOnFocusOut(this)" class="w-100 op-0-0 selectEvent m-t-5 selectEvent_Date">
						<option selected>Выбрать причину</option>
						<option value="1">Проблемы с регистрацией</option>
						<option>Проблемы с профилем</option>
						<option>Другая проблема</option>
					</select>
					<div class="dropdowmMy" style="width: 100%;">
						<p class="selectEvent_DateP colorB4B0B0" style="color: #000;" id="selected">Выбрать причину</p>
						<img src="./imgs/arrow_down.png" alt="">
					</div>
				</div>
				<textarea placeholder="Описание вашей проблемы" id="desc_problem" maxlength="1500"></textarea>
				<input type="button" id="submit" class="support_btn" value="Отправить">
			</div>
		</div>
	</main>  

	<script src="./libs/jquery.min.js"></script>
	<script src="./libs/bootstrap.min.js"></script>

	<script src="./js/modal.js"></script>
	<script src="./js/checkPage.js"></script>
	
	<script>
		function selectOnFocusOut(thisSelect) {
		    parentDiv = thisSelect.parentNode;
		    backSelect = parentDiv.children[1];
		    img = backSelect.children[1];
		    img.classList.remove('transf');
		}

		function selectOnClick(thisSelect) {
		    parentDiv = thisSelect.parentNode;
		    backSelect = parentDiv.children[1];
		    img = backSelect.children[1];
		    img.classList.toggle('transf');
		}

		selectEvent = document.getElementsByClassName('selectEvent');
		for(var i = 0; i < selectEvent.length;i++) {
		    selectEvent[i].addEventListener("change", selectEventFunc, false);
		}

		function selectEventFunc () {
		    parentDiv = this.parentNode;
		    backSelect = parentDiv.children[1];
		    p = backSelect.children[0];
		    p.innerHTML = this.options[this.selectedIndex].text;
		}

		try {
			$("#email").val(JSON.parse($store.getItem("userdata")).email);
		} catch (e) {
			console.log(e); 
		}
		
		if($store.getItem("userdata") != null) {
			$(".selectEvent option[value='1']").remove();
		}

		$(".back_support").click(function () {
			$store.setItem("currentPage", $store.getItem("lastPage"));
			location.href = "./" + $store.getItem("lastPage");
		});

		$("#submit").click(function () {
			var email = $("#email").val();
			var msg = $("#desc_problem").val();
			var reason = $("#selected").text();

			$('#submit').prop('disabled', true);
			if(email.match("^((([0-9A-Za-z]{1}[-0-9A-z\.]{1,}[0-9A-Za-z]{1})|([0-9А-Яа-я]{1}[-0-9А-я\.]{1,}[0-9А-Яа-я]{1}))@([-0-9A-Za-z]{1,}\.){1,2}[-A-Za-z]{2,})") == null || (email.length <= 4 || email.length >= 30)) {
				modal_alert("Ошибка ввода данных!", 1, "Email введен не коректно!", function () {
					$('#submit').prop('disabled', false);
				}); 
			} else if(reason == "Выберите причину") {
				modal_alert("Ошибка ввода данных!", 1, "Вы не выбрали причину!", function () {
					$('#submit').prop('disabled', false);
				}); 
			} else {
				$.post("http://taxitime.pro/api/Support.php", { 
					supportEmail: email,
					supportMsg: msg,
					supportReason: reason
				}).done(function (data) {
					modal_alert("Данные были отправлены!", 3, "Дождитесь ответа от службы поддержки, письмо прийдет на почту : " + email + "!", function () {
						$('#submit').prop('disabled', false);
						$store.setItem("currentPage", $store.getItem("lastPage"));
						location.href = "./" + $store.getItem("lastPage");
					});
				}).fail(function(xhr, textStatus, error){
					modal_alert("Server error!", 2, "xhr.statusText: " + xhr.statusText + "<br>textStatus: " + textStatus + "<br>error: " + error + "<br>", function () {
						$('#submit').prop('disabled', false);
						$store.setItem("currentPage", $store.getItem("lastPage"));
						location.href = "./" + $store.getItem("lastPage");
					});
				});
			}
		});
	</script>

</body>
</html>